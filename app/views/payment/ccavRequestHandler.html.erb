
<center>
  <%
    merchantData="merchant_id=#{ENV['MERCHANT_ID']}"
    working_key="#{ENV['WORKING_KEY']}"   #Put in the 32 Bit Working Key provided by CCAVENUES.
    access_code="#{ENV['ACCESS_CODE']}"   #Put in the Access Code in quotes provided by CCAVENUES.
    referer = request.referer

    merchantData += "&currency=INR&redirect_url=http://test.machpay.com/payment/ccavResponseHandler&cancel_url=http://test.machpay.com/payment/ccavResponseHandler&integration_type=iframe_normal&language=EN&merchant_param1=#{referer}&"

    params.each do |key,value|
      merchantData += key+"="+value+"&"
    end

    encrypted_data = @crypto.encrypt(merchantData,working_key)
  %>
    <!--<iframe  width="482" height="500" scrolling="Yes" frameborder="0"  id="paymentFrame" src="https://test.ccavenue.com/transaction/transaction.do?command=initiateTransaction&encRequest=<%encrypted_data %>&access_code=<%access_code %>"></iframe>-->
</center>

<!--<script type="text/javascript" src="assets/javascripts/jquery-1.7.2.js"></script>-->
<script type="text/javascript">
  window.location = "https://test.ccavenue.com/transaction/transaction.do?command=initiateTransaction&encRequest=<%=encrypted_data %>&access_code=<%=access_code %>";
//  $(document).ready(function(){
//    $('iframe#paymentFrame').load(function() {
//      window.addEventListener('message', function(e) {
//        $("#paymentFrame").css("height",e.data['newHeight']+'px');
//      }, false);
//    });
//  });
</script>

