
<center>
  <%
    merchant_data="merchant_id=#{ENV['MERCHANT_ID']}"
    working_key="#{ENV['WORKING_KEY']}"   #Put in the 32 Bit Working Key provided by CCAVENUES.
    access_code="#{ENV['ACCESS_CODE']}"   #Put in the Access Code in quotes provided by CCAVENUES.
    referer = request.referer

    merchant_data += "&currency=INR&redirect_url=http://test.machpay.com/payments/ccavResponseHandler&cancel_url=http://test.machpay.com/payments/ccavResponseHandler&integration_type=iframe_normal&language=EN&merchant_param1=#{referer}&"


    params.each do |key, value|
      if value.is_a? String
        merchant_data += prepare_merchant_data(key, value)
      elsif value.is_a? Hash
        merchant_data += merchant_data_from_hash(value)
      elsif value.is_a? Array
        merchant_data += merchant_data_from_array(value)
      end
    end

    encrypted_data = @crypto.encrypt(merchant_data,working_key)
  %>
</center>

<!--<script type="text/javascript" src="assets/javascripts/jquery-1.7.2.js"></script>-->
<script type="text/javascript">
  window.location = "https://test.ccavenue.com/transaction/transaction.do?command=initiateTransaction&encRequest=<%=encrypted_data %>&access_code=<%=access_code %>";

</script>






